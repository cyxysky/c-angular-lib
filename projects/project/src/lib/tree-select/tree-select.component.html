<lib-select-box 
    (click)="openDropdown()" 
    cdkOverlayOrigin

    [selectMode]="multiple ? 'multiple' : 'single'"
    [loading]="loading"
    [size]="size"
    [borderless]="borderless"
    [disabled]="disabled"
    [placeholder]="placeholder"
    [status]="status"
    [isActive]="isDropdownOpen"

    [optionLabelTemplate]="labelTemplate"
    [getLabel]="getLabel"

    [(searchValue)]="searchValue"
    [data]="!multiple ? getSingleNodeTitle() : displayTags"
    #searchInput

    (clear)="clear()"
    (remove)="removeItem($event.value)"
    (search)="onSearch($event)"
    (inputWidthChange)="updateDropdownPosition()"
    >
</lib-select-box>

<!-- 下拉菜单 -->
<ng-template #dropdownTemplate>
    <div class="tree-select-dropdown"
        [class.open]="isDropdownOpen" 
        [class.closed]="!isDropdownOpen"
        [style.min-width]="dropdownWidth">
        
        <!-- 搜索结果树 -->
        <div class="tree-container" [style.max-height.px]="dropdownHeight">
            <!-- 树组件 -->
            <lib-tree
                [treeData]="treeData"
                [treeSearchValue]="searchValue"
                [treeOptionHeight]="treeOptionHeight"
                [treeIndent]="treeIndent"
                [treeCheckable]="treeCheckable"
                [treeMultiple]="multiple"
                [treeShowLine]="treeShowLine"
                [treeShowIcon]="treeShowIcon"
                [treeAsyncData]="treeAsyncData"
                [treeVirtualHeight]="dropdownHeight"
                [treeIsVirtualScroll]="treeVirtualScroll"
                [treeExpandedIcon]="expandedIcon"
                [treeVirtualHeight]="dropdownHeight"
                [treeVirtualItemSize]="treeVirtualItemSize"
                [treeVirtualMinBuffer]="treeVirtualMinBuffer"
                [treeVirtualMaxBuffer]="treeVirtualMaxBuffer"
                [treeDefaultExpandedKeys]="defaultExpandedKeys"
                [treeDefaultSelectedKeys]="defaultSelectedKeys"
                [treeDefaultCheckedKeys]="defaultCheckedKeys"
                [treeTemplate]="treeNodeTemplate"
                (expandChange)="focusSearch()"
                (selectedChange)="onNodeSelect($event.node)"
                (checkBoxChange)="onCheckBoxChange($event)"
                (loadData)="onLoadData($event)">
            </lib-tree>
        </div>
    </div>
</ng-template>
