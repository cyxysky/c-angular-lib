<div class="checkbox-group" [class.checkbox-vertical]="direction === 'vertical'" [class.checkbox-horizontal]="direction === 'horizontal'">  
  <div class="checkbox-options">
    <ng-container *ngIf="!single">
      <label class="checkbox-wrapper" *ngFor="let option of options" [class.checkbox-disabled]="disabled || option.disabled">
        <ng-container *ngTemplateOutlet="checkboxOption; context: { $implicit: option }"></ng-container>
      </label>
    </ng-container>
    <label class="checkbox-wrapper" *ngIf="single" [class.checkbox-disabled]="disabled">
      <ng-container *ngTemplateOutlet="singleLabel"></ng-container>
    </label>
  </div>
</div>

<!-- 单选模式 -->
<ng-template #singleLabel let-option>
  <span class="checkbox-input">
    <input 
      type="checkbox" 
      [checked]="singleValue" 
      [indeterminate]="indeterminate"
      [disabled]="disabled"
      (change)="checkSingle()"
    />
    <ng-container *ngTemplateOutlet="checkboxInner; context: { $implicit:  singleValue, indeterminate: indeterminate, disabled: disabled }"></ng-container>
  </span>
  <ng-container *ngIf="isTemplate(singleLabelContent)" [ngTemplateOutlet]="singleLabelContent"></ng-container>
  <ng-container *ngIf="!isTemplate(singleLabelContent)" [ngTemplateOutlet]="defaultLabel"></ng-container>
</ng-template>

<ng-template #checkboxInner let-checked let-indeterminate="indeterminate" let-disabled="disabled">
  <span 
    class="checkbox-box" 
    [class.checked]="!indeterminate && checked"
    [class.indeterminate]="indeterminate"
    [class.disabled]="disabled"
    [style.backgroundColor]="checked ? checkboxColor : ''"
    [style.borderColor]="checked ? checkboxColor : ''"
  >
    <span class="checkbox-inner" [style.--before-color]="indeterminateColor ? indeterminateColor : '#1890ff'"></span>
  </span>
</ng-template>

<!-- 多选模式 -->
<ng-template #checkboxOption let-option>
  <span class="checkbox-input">
    <input 
      type="checkbox" 
      [checked]="isChecked[getOptionKey(option.value)]" 
      [indeterminate]="option.indeterminate"
      [disabled]="disabled || option.disabled"
      (change)="toggleOption(option)"
    />
    <ng-container *ngTemplateOutlet="checkboxInner; context: { $implicit:  isChecked[getOptionKey(option.value)], indeterminate: option.indeterminate, disabled: disabled || option.disabled }"></ng-container>
  </span>
  <ng-container *ngTemplateOutlet="labelTemplate || defaultLabel; context: { $implicit: option }"></ng-container>
</ng-template>

<!-- 默认标签 -->
<ng-template #defaultLabel let-option>
  <span class="checkbox-label" *ngIf="!single">{{ option.label }}</span>
  <span class="checkbox-label" *ngIf="single">{{ singleLabelContent }}</span>
</ng-template>