<div 
    class="lib-menu" 
    [class.lib-menu-inline]="mode === 'inline'" 
    [class.lib-menu-vertical]="mode === 'vertical'"
    [class.lib-menu-horizontal]="mode === 'horizontal'"
    [class.lib-menu-light]="theme === 'light'"
    [class.lib-menu-dark]="theme === 'dark'" 
    [class.lib-menu-collapsed]="inlineCollapsed"
    [style.width.px]="inlineCollapsed ? 64 : ''">
    <ul class="lib-menu-root">
        <ng-container *ngFor="let item of internalItems">
            <!-- 有子菜单的项 -->
            <li *ngIf="item.children && item.children.length > 0" class="lib-menu-submenu"
                [class.lib-menu-submenu-open]="item.isOpen" [class.lib-menu-submenu-selected]="hasSelectedChild(item)"
                [class.lib-menu-submenu-disabled]="item.disabled">

                <div class="lib-menu-submenu-title"
                    [style.paddingLeft.px]="(mode === 'inline' && !inlineCollapsed) ? inlineIndent : 24"
                    (click)="(mode === 'inline' && !inlineCollapsed) ? toggleSubMenu(item) : onMenuItemClick(item.children[0])"
                    (mouseenter)="(mode !== 'inline' || inlineCollapsed) && onMouseEnterSubmenu(item)"
                    (mouseleave)="(mode !== 'inline' || inlineCollapsed) && onMouseLeaveSubmenu(item)">
                    <i *ngIf="item.icon" class="menu-icon" [class]="item.icon"></i>
                    <span class="lib-menu-title-content" *ngIf="!inlineCollapsed || mode !== 'inline'">{{ item.title
                        }}</span>
                    <!-- 只在非水平模式下显示箭头 -->
                    <i class="lib-menu-submenu-arrow"
                        *ngIf="(mode !== 'horizontal') && (!inlineCollapsed || mode !== 'inline')"></i>
                </div>

                <!-- 内联模式下的子菜单 -->
                <div *ngIf="mode === 'inline' && !inlineCollapsed">
                    <ul class="lib-menu-sub lib-menu-inline" *ngIf="item.isOpen" [@expandCollapse]>
                        <ng-container *ngFor="let child of item.children">
                            <!-- 递归处理子菜单 -->
                            <li *ngIf="child.children && child.children.length > 0" class="lib-menu-submenu"
                                [class.lib-menu-submenu-open]="child.isOpen"
                                [class.lib-menu-submenu-selected]="hasSelectedChild(child)"
                                [class.lib-menu-submenu-disabled]="child.disabled">

                                <div class="lib-menu-submenu-title" [style.paddingLeft.px]="inlineIndent * 2"
                                    (click)="toggleSubMenu(child)">
                                    <i *ngIf="child.icon" class="menu-icon" [class]="child.icon"></i>
                                    <span class="lib-menu-title-content">{{ child.title }}</span>
                                    <i class="lib-menu-submenu-arrow"></i>
                                </div>

                                <div *ngIf="child.isOpen">
                                    <ul class="lib-menu-sub lib-menu-inline" [@expandCollapse]>
                                        <li *ngFor="let subChild of child.children" class="lib-menu-item"
                                            [class.lib-menu-item-selected]="subChild.selected"
                                            [class.lib-menu-item-disabled]="subChild.disabled"
                                            [style.paddingLeft.px]="inlineIndent * 3"
                                            (click)="onMenuItemClick(subChild)">
                                            <i *ngIf="subChild.icon" class="menu-icon" [class]="subChild.icon"></i>
                                            <span class="lib-menu-title-content">{{ subChild.title }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </li>

                            <!-- 没有子菜单的项 -->
                            <li *ngIf="!child.children || child.children.length === 0" class="lib-menu-item"
                                [class.lib-menu-item-selected]="child.selected"
                                [class.lib-menu-item-disabled]="child.disabled"
                                [style.paddingLeft.px]="inlineIndent * 2" (click)="onMenuItemClick(child)">
                                <i *ngIf="child.icon" class="menu-icon" [class]="child.icon"></i>
                                <span class="lib-menu-title-content">{{ child.title }}</span>
                            </li>
                        </ng-container>
                    </ul>
                </div>

                <!-- 垂直模式或水平模式或折叠状态下的子菜单 -->
                <ul class="lib-menu-sub"
                    *ngIf="(mode === 'vertical' || mode === 'horizontal' || (mode === 'inline' && inlineCollapsed)) && item.isOpen"
                    [class.lib-menu-vertical-sub]="mode === 'vertical' || (mode === 'inline' && inlineCollapsed)"
                    [class.lib-menu-horizontal-sub]="mode === 'horizontal'" (mouseenter)="onMouseEnterSubMenu(item)"
                    (mouseleave)="onMouseLeaveSubMenu(item)">
                    <ng-container *ngFor="let child of item.children">
                        <!-- 递归处理子菜单 -->
                        <li *ngIf="child.children && child.children.length > 0" class="lib-menu-submenu"
                            [class.lib-menu-submenu-open]="child.isOpen"
                            [class.lib-menu-submenu-selected]="hasSelectedChild(child)"
                            [class.lib-menu-submenu-disabled]="child.disabled">

                            <div class="lib-menu-submenu-title" (click)="toggleSubMenu(child)"
                                (mouseenter)="onMouseEnterSubmenu(child)" (mouseleave)="onMouseLeaveSubmenu(child)">
                                <i *ngIf="child.icon" class="menu-icon" [class]="child.icon"></i>
                                <span class="lib-menu-title-content">{{ child.title }}</span>
                                <!-- 子级子菜单箭头显示 -->
                                <i class="lib-menu-submenu-arrow"></i>
                            </div>

                            <ul class="lib-menu-sub" *ngIf="child.isOpen"
                                [class.lib-menu-vertical-sub]="mode === 'vertical' || (mode === 'inline' && inlineCollapsed)"
                                (mouseenter)="onMouseEnterSubMenu(child)" (mouseleave)="onMouseLeaveSubMenu(child)">
                                <li *ngFor="let subChild of child.children" class="lib-menu-item"
                                    [class.lib-menu-item-selected]="subChild.selected"
                                    [class.lib-menu-item-disabled]="subChild.disabled"
                                    (click)="onMenuItemClick(subChild)">
                                    <i *ngIf="subChild.icon" class="menu-icon" [class]="subChild.icon"></i>
                                    <span class="lib-menu-title-content">{{ subChild.title }}</span>
                                </li>
                            </ul>
                        </li>

                        <!-- 没有子菜单的项 -->
                        <li *ngIf="!child.children || child.children.length === 0" class="lib-menu-item"
                            [class.lib-menu-item-selected]="child.selected"
                            [class.lib-menu-item-disabled]="child.disabled" (click)="onMenuItemClick(child)">
                            <i *ngIf="child.icon" class="menu-icon" [class]="child.icon"></i>
                            <span class="lib-menu-title-content">{{ child.title }}</span>
                        </li>
                    </ng-container>
                </ul>
            </li>

            <!-- 没有子菜单的项 -->
            <li *ngIf="!item.children || item.children.length === 0" class="lib-menu-item"
                [class.lib-menu-item-selected]="item.selected" [class.lib-menu-item-disabled]="item.disabled"
                [style.paddingLeft.px]="(mode === 'inline' && !inlineCollapsed) ? inlineIndent : 24"
                (click)="onMenuItemClick(item)">
                <i *ngIf="item.icon" class="menu-icon" [class]="item.icon"></i>
                <span class="lib-menu-title-content" *ngIf="!inlineCollapsed || mode !== 'inline'">{{ item.title
                    }}</span>
            </li>
        </ng-container>
    </ul>
</div>